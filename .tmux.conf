# dclaude tmux configuration - transparent mode
# This makes tmux invisible to the user while keeping session persistence

# Fix terminal compatibility
set-option -g default-terminal "screen-256color"
set-option -ga terminal-overrides ",xterm-256color:Tc"

# Fix keyboard input delays - CRITICAL for responsive input
set-option -sg escape-time 0
set-option -g repeat-time 300

# Disable aggressive resizing that can cause input lag
set-window-option -g aggressive-resize off

# Increase client activity monitoring for better responsiveness
set-option -g focus-events on

# Enable scrollback with large history
set-option -g history-limit 50000

# Allow alternate screen (Claude needs it)
set-window-option -g alternate-screen on

# Enable mouse support for iTerm2 native scrollback integration
set-option -g mouse on

# Disable visual bells but pass through audio bells
set-option -g visual-activity off
set-option -g visual-bell off
set-option -g visual-silence off
set-option -g bell-action any

# Unbind all detach keys so users can't accidentally detach
unbind-key d
unbind-key D
unbind-key C-d

# Disable prefix to make tmux transparent
set-option -g prefix None
unbind-key C-b

# Keep terminal title updated
set-option -g set-titles on
set-option -g set-titles-string "Claude Code"

# Status bar configuration
# Style: dark background, orange labels/dividers, white values
set-option -g status on
set-option -g status-position bottom
# Use terminal's own background color (blends with iTerm)
set-option -g status-style "bg=default,fg=#D97757"
set-option -g status-interval 60
set-option -g status-left-length 100
set-option -g status-right-length 80

# Hide default window list
set-window-option -g window-status-format ""
set-window-option -g window-status-current-format ""

# Left: net + dir
# Labels: orange (#D97757), Values: terminal foreground, Separator: orange dot
set-option -g status-left " net: #[fg=terminal]#(printenv _DCLAUDE_NET || echo '?')#[fg=#D97757] • dir: #[fg=terminal]#{pane_current_path}"

# Center: session (via window-status-current)
set-option -g status-justify centre
set-window-option -g window-status-current-format "#[fg=#D97757]session: #[fg=terminal]#(printenv _DCLAUDE_SESSION || echo '?')"

# Right: claude version + image
set-option -g status-right "#[fg=#D97757]claude: #[fg=terminal]#(claude --version 2>/dev/null | grep -oE '[0-9]+\\.[0-9]+\\.[0-9]+' || echo '?') #[fg=#D97757]• image: #[fg=terminal]#(printenv _DCLAUDE_TAG || echo '?') "


# When the last pane exits, detach instead of switching sessions
set-option -g detach-on-destroy on

# Pass through all signals
set-option -g remain-on-exit off

# Reset terminal mouse mode on client detach to prevent iTerm2 warnings
# about mouse reporting being left on
set-hook -g client-detached 'run-shell "printf \"\033[?1000l\033[?1002l\033[?1003l\033[?1006l\""'
